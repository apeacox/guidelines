<!DOCTYPE html><html><head><title>best practices, su codice e test — Guidelines Cantiere Creativo</title><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><link href="../../stylesheets/application.css" rel="stylesheet" type="text/css" /></head><body><section class="aside"><header class="aside__header"><h1 class="header__title">Guidelines<br>Cantiere Creativo</h1></header><nav class="chapters"><h5 class="chapters__title">Intro</h5><ul class="chapters__content"><li><a href="/">Home</a></li><li><a href="../../documenti/contratto-cantiere-creativo-marzo-13.pdf">Modello contratto</a></li></ul><h5 class="chapters__title">Metodologia</h5><ul class="chapters__content"><li><a href="../chapters/processo">Processo</a></li><li><a href="../chapters/clienti">Clienti</a></li><li><a href="../chapters/team-planning">Team Planning</a></li></ul><h5 class="chapters__title">Coding</h5><ul class="chapters__content"><li><a href="../chapters/protocollo">Protocollo</a></li><li><a href="../chapters/code">Code</a></li><li><a href="../chapters/frontend">Frontend</a></li><li><a href="../chapters/design">Design</a></li></ul><h5 class="chapters__title">Sharing</h5><ul class="chapters__content"><li><a href="../chapters/blog">Blog</a></li><li><a href="../chapters/twitter">Twitter</a></li></ul><h5 class="chapters__title">Formazione</h5><ul class="chapters__content"><li><a href="../chapters/ricerca">Ricerca</a></li><li><a href="../chapters/hackathons">Hackathons</a></li></ul></nav><footer class="aside__footer"><ul><li><a class="aside__footer__link" href="http://www.cantierecreativo.net">Cantiere Creativo</a></li><li><a class="aside__footer__link" href="http://www.leanpanda.com">LeanPanda</a></li></ul></footer></section><section class="l-content"><article class="formatted-content"><h1>Coding best practices</h1>

<p>Una nota sul linguaggio utilizzato:</p>

<ul>
<li>&quot;Non fare X&quot; significa che <strong>non esiste</strong> motivo valido per violare la regola.</li>
<li>&quot;Evita X&quot; significa non farlo <strong>a meno di un valido motivo</strong>.</li>
<li>&quot;Prediligi X ad Y&quot; descrive una pratica sconsigliata, ed una alternativa da favorire <strong>a meno di un valido motivo</strong>.</li>
</ul>

<h2>Linee guida ad alto livello</h2>

<ul>
<li>Sii coerente.</li>
<li>Non riscrivere codice già esistente per seguire questa guida.</li>
<li>Non violare le linee guida senza un valido motivo. Se riesci a convincere un altro membro del tuo team, allora il motivo può considerarsi valido.</li>
</ul>

<h2>Generali</h2>

<ul>
<li>Non duplicare funzionalità già presenti in librerie di sistema.</li>
<li>Non fallire silenziosamente <em>ingoiando</em> eccezioni. <a href="http://www.codinghorror.com/blog/2007/08/whats-worse-than-crashing.html">→</a></li>
<li>Non scrivere codice cercando di predire future necessità. <a href="http://c2.com/cgi/wiki?DoTheSimplestThingThatCouldPossiblyWork">→</a></li>
<li>Evita di usare eccezioni per gestire control flow ordinario. <a href="http://pragmatictips.com/34">→</a></li>
<li>Mantieni il codice semplice, chiaro ed esplicito. <a href="http://code.mumak.net/2012/02/simple-made-easy.html">→</a></li>
<li>Evita di ottimizzare il codice. Non farlo mai senza profiling. <a href="http://c2.com/cgi/wiki?ProfileBeforeOptimizing">→</a></li>
</ul>

<h2>Principi di object-oriented design</h2>

<ul>
<li>Evita variabili globali e singletons. <a href="http://stackoverflow.com/questions/484635/are-global-variables-bad">→</a></li>
<li>Evita un numero di parametri superiore a 4. <a href="http://sourcemaking.com/refactoring/long-parameter-list">→</a></li>
<li>Limita il numero di collaboratori di un oggetto (le entità da cui dipende l&#39;oggetto).</li>
<li>Limita il numero di dipendenze di un oggetto (le entitità che dipendono dall&#39;oggetto).</li>
<li>Prediligi la composizione rispetto all&#39;ereditarietà. <a href="http://stackoverflow.com/questions/49002/prefer-composition-over-inheritance">→</a></li>
<li>Prediligi metodi brevi. Ottimo rimanere tra 1 e 5 righe. <a href="http://c2.com/cgi/wiki?LongMethodSmell">→</a></li>
<li>Prediligi piccoli oggetti, con una singola responsabilità ben definita. Quando un oggetto supera le 100 righe, è probabile stia facendo troppe cose. <a href="http://c2.com/cgi/wiki?OneResponsibilityRule">→</a></li>
<li><em>Tell, don&#39;t ask</em>. <a href="http://c2.com/cgi/wiki?TellDontAsk">→</a></li>
<li>Evita metodi che uniscono responsabilità <em>query</em> e <em>command</em>. <a href="http://en.wikipedia.org/wiki/Command%E2%80%93query_separation">→</a></li>
</ul>

<h2>Ruby</h2>

<ul>
<li>Evita parametri opzionali. Il metodo forse sta facendo più del dovuto?</li>
<li>Evita inutile metaprogramming.</li>
<li>Evita il monkey-patching.</li>
<li>Prediligi la creazione di classi all&#39;inclusione di moduli per condividere funzionalità tra più oggetti.</li>
<li>Prediligi lo scope <code>private</code> a <code>protected</code>. Usa <code>protected</code> solo per i metodi di comparazione come <code>def ==(other)</code>, <code>def &lt;(other)</code>, e <code>def &gt;(other)</code>.</li>
<li>Effettua <code>rescue</code> di <code>StandardError</code>, non <code>Exception</code>. <a href="http://robots.thoughtbot.com/rescue-standarderror-not-exception/">→</a></li>
</ul>

<h2>Rails</h2>

<ul>
<li>Evita di bypassare le validazioni con metodi quali <code>save(validate: false)</code> o <code>update_attribute</code>. <a href="https://github.com/garybernhardt/do_not_want">→</a></li>
<li>Non modificare una migrazione dopo che è stata mergiata su master se il cambiamento voluto può essere introdotto con una seconda migrazione.</li>
<li>Non richiamare le classi dei modelli <code>ActiveRecord</code> all&#39;interno dalle viste.</li>
<li>Non usare variabili d&#39;istanza nei partials.</li>
<li>Non usare SQL o frammenti SQL (<code>where(&#39;inviter_id IS NOT NULL&#39;)</code>) al di fuori dei modelli.</li>
<li>Valida la presenza dell&#39;associazione <code>belongs_to</code> (<code>user</code>), non della foreign key (<code>user_id</code>).</li>
<li>Aggiungi un indice DB per ogni foreign key. <a href="https://tomafro.net/2009/08/using-indexes-in-rails-index-your-associations">→</a></li>
<li>Imposta valori di default, validazioni di presenza o unicità nei modelli anche a livello di migrazione DB.</li>
<li>Mantieni <code>db/schema.rb</code> sotto version control.</li>
<li>Non fare riferimento a modelli <code>ActiveRecord</code> a livello di migrazione.</li>
<li>Nelle viste mailer usa named routes con suffissi <code>_url</code>. In tutti gli altri casi, usa il suffisso <code>_path</code>. <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30">→</a></li>
<li>Evita di instanziare più di un oggetto per azione nei controller.</li>
<li>Sfrutta solo una variabile di istanza per vista.</li>
<li>Assicurati che le migrazioni down funzionino. <a href="http://stefanoverna.com/blog/2013/08/test-down-migrations-tip.html">→</a></li>
<li>Evita l&#39;introduzione di nuovi metodi helper. Prediligi un&#39;approccio ad oggetti tramite l&#39;uso di presenters. <a href="http://nicksda.apotomo.de/2011/10/rails-misapprehensions-helpers-are-shit/">→</a></li>
<li>A livello di model <code>ActiveRecord</code> specifica unicamente validazioni, relazioni e scopes/query.</li>
<li>Non specificare a livello model <code>ActiveRecord</code> validazioni che necessitino il lookup di relazioni.</li>
</ul>

<h2>Testing</h2>

<ul>
<li>Mantieni un code coverage superiore al 90%.</li>
<li>Evita test ridondanti (uno e un solo test per funzionalità).</li>
<li>Evita <code>its</code>, <code>let!</code>, <code>specify</code> e <code>subject</code> in RSpec. Prediligi approcci espliciti e coerenti.</li>
<li>Specifica una sola expectation per test.</li>
<li>Separa le fasi di <em>setup</em> ed <em>exercise</em> dalla fase <em>verify</em> del test tramite blocchi <code>before</code>.</li>
<li>Evita <code>.any_instance</code>, sfrutta il <em>dependency injection</em>. <a href="http://kresimirbojcic.com/2011/11/19/dependency-injection-in-ruby.html">→</a></li>
<li>Evita l&#39;utilizzo di variabili di istanza.</li>
<li>Disabilita richieste HTTP verso servizi esterni tramite <a href="https://github.com/bblimke/webmock">WebMock</a> o <a href="https://github.com/chrisk/fakeweb">FakeWeb</a>.</li>
</ul>

<h2>Unit testing</h2>

<ul>
<li>Non testare i metodi privati (non stubbare il SUT). <a href="http://robots.thoughtbot.com/don-t-stub-the-system-under-test/">→</a></li>
<li>Testa metodi di tipo query con expectations sul valore di ritorno.</li>
<li>Testa metodi di tipo command con expectations su diretti cambiamenti
di stato provocati sull&#39;interfaccia pubblica dell&#39;oggetto.</li>
<li>Non testare chiamate di tipo query verso oggetti collaboratori.</li>
<li>Testa chiamate di tipo command verso oggetti collaboratori tramite stubs e spies (non mocks). <a href="http://robots.thoughtbot.com/post/159805295/spy-vs-spy">→</a></li>
<li>Mantieni gli stub in sync con l&#39;API che vanno a simulare. Nel farlo prediligi approcci unit rispetto a test di integrazione. <a href="https://www.relishaphttps//www.relishapp.com/bogus/bogus/v/0-1-4/docs/p.com/bogus/bogus/v/0-1-4/docs/">→</a></li>
</ul>

<h2>Gemfile</h2>

<ul>
<li>Dichiara la versione ruby da utilizzare per un progetto. <a href="http://bundler.io/v1.3/gemfile_ruby.html">→</a></li>
<li>Specifica la versione con <code>~&gt;</code> per le gemme che seguono il semantic versioning (<code>rspec</code>, <code>factory_girl</code>, <code>capybara</code>). <a href="http://robots.thoughtbot.com/post/35717411108/a-healthy-bundle">→</a></li>
<li>Specifica la versione esatta per gemme fragili (<code>rails</code>).</li>
<li>Non specificare una versione per gemme stabili e sicure (<code>pg</code>, <code>thin</code>).</li>
</ul>

<h2>Background Jobs</h2>

<ul>
<li>Non persistere oggetti <code>ActiveRecord</code> serializzati nel job. Passa gli ID ed esegui la <code>.find</code> all&#39;interno del metodo <code>.perform</code>.</li>
</ul>
</article></section></body></html>